# JavaScript异步机制

## 同步任务与异步任务

如果你看了我有关闭包讲解的文章，应该就会了解到我在闭包那篇文章里讲解`setTimeout()`函数的功能时，有关JavaScript异步机制的简单介绍，现在我将在这篇文章里提纲挈领地介绍JavaScript的异步机制。

JS是单线程的，天生异步，适合IO密集型，不适合CPU密集型。单线程意味着它无法在同一时间去处理多个事情，我们人类是多线程的，我们可以边打字边纠正文字错误，像这种在同一时间只能做一件事情机制被称为“阻塞式”执行，它的所有待处理任务不得不一个一个地排队进行。

JS中的任务可以分为同步任务与异步任务，同步任务比较常见，像是`console.log()`一类就是同步任务，而对于需要改变页面或者渲染页面的任务，比如图片加载、按钮点击事件就是异步任务。主线程在执行任务时会首先将待处理的同步任务按照代码的顺序放入任务执行栈，而当遇到异步任务时，会将异步任务放入任务队列中。当同步任务执行完，任务执行栈也就被清空了，这时候才会将任务队列中的异步任务放入任务执行栈内，按照次序去执行异步任务。

以下代码的执行过程就是先执行同步任务，再执行异步任务的过程：

```js
console.log("a");
function fun1(){
  console.log("b");
  function fun2(){
    console.log("c");
  }
  fun2();
}
fun1();
setTimeout(function(){
  console.log("setTimeout");
}, 1000);
console.log("d");
```

![运行结果](./img/1.png)
